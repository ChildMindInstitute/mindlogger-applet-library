{"version":3,"sources":["../../src/ts/rendering/columnAnimationService.ts"],"names":[],"mappings":"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","file":"columnAnimationService.js","sourcesContent":["import { Autowired, Bean } from \"../context/context\";\nimport { GridOptionsWrapper } from \"../gridOptionsWrapper\";\nimport { GridPanel } from \"../gridPanel/gridPanel\";\nimport { _ } from \"../utils\";\n\n@Bean('columnAnimationService')\nexport class ColumnAnimationService {\n\n    @Autowired('gridOptionsWrapper') private gridOptionsWrapper: GridOptionsWrapper;\n\n    private gridPanel: GridPanel;\n\n    private executeNextFuncs: Function[] = [];\n    private executeLaterFuncs: Function[] = [];\n\n    private active = false;\n\n    private animationThreadCount = 0;\n\n    public registerGridComp(gridPanel: GridPanel): void {\n        this.gridPanel = gridPanel;\n    }\n\n    public isActive(): boolean {\n        return this.active;\n    }\n\n    public start(): void {\n        if (this.active) { return; }\n\n        if (this.gridOptionsWrapper.isSuppressColumnMoveAnimation()) { return; }\n\n        // if doing RTL, we don't animate open / close as due to how the pixels are inverted,\n        // the animation moves all the row the the right rather than to the left (ie it's the static\n        // columns that actually get their coordinates updated)\n        if (this.gridOptionsWrapper.isEnableRtl()) { return; }\n\n        this.ensureAnimationCssClassPresent();\n\n        this.active = true;\n    }\n\n    public finish(): void {\n        if (!this.active) { return; }\n        this.flush();\n        this.active = false;\n    }\n\n    public executeNextVMTurn(func: Function): void {\n        if (this.active) {\n            this.executeNextFuncs.push(func);\n        } else {\n            func();\n        }\n    }\n\n    public executeLaterVMTurn(func: Function): void {\n        if (this.active) {\n            this.executeLaterFuncs.push(func);\n        } else {\n            func();\n        }\n    }\n\n    private ensureAnimationCssClassPresent(): void {\n        // up the count, so we can tell if someone else has updated the count\n        // by the time the 'wait' func executes\n        this.animationThreadCount++;\n        const animationThreadCountCopy = this.animationThreadCount;\n        this.gridPanel.setColumnMovingCss(true);\n\n        this.executeLaterFuncs.push(() => {\n            // only remove the class if this thread was the last one to update it\n            if (this.animationThreadCount === animationThreadCountCopy) {\n                this.gridPanel.setColumnMovingCss(false);\n            }\n        });\n    }\n\n    public flush(): void {\n\n        const nowFuncs = this.executeNextFuncs;\n        this.executeNextFuncs = [];\n\n        const waitFuncs = this.executeLaterFuncs;\n        this.executeLaterFuncs = [];\n\n        if (nowFuncs.length === 0 && waitFuncs.length === 0) { return; }\n\n        window.setTimeout(() => nowFuncs.forEach(func => func()), 0);\n        window.setTimeout(() => waitFuncs.forEach(func => func()), 300);\n    }\n}"]}