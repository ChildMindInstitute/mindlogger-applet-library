{"version":3,"sources":["../../src/ts/filter/provided/text/textFilter.ts"],"names":[],"mappings":"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","file":"textFilter.js","sourcesContent":["import { IDoesFilterPassParams } from \"../../../interfaces/iFilter\";\nimport { RefSelector } from \"../../../widgets/componentAnnotations\";\nimport { _ } from \"../../../utils\";\nimport {\n    SimpleFilter,\n    ConditionPosition,\n    ISimpleFilterParams,\n    ISimpleFilterModel\n} from \"../simpleFilter\";\n\nexport interface TextFilterModel extends ISimpleFilterModel {\n    filter?: string;\n}\n\nexport interface TextComparator {\n    (filter: string, gridValue: any, filterText: string): boolean;\n}\n\nexport interface TextFormatter {\n    (from: string): string;\n}\n\nexport interface ITextFilterParams extends ISimpleFilterParams {\n    textCustomComparator?: TextComparator;\n    caseSensitive?: boolean;\n    textFormatter?: (from: string) => string;\n}\n\nexport class TextFilter extends SimpleFilter<TextFilterModel> {\n\n    private static readonly FILTER_TYPE = 'text';\n\n    public static DEFAULT_FILTER_OPTIONS = [SimpleFilter.CONTAINS, SimpleFilter.NOT_CONTAINS,\n        SimpleFilter.EQUALS, SimpleFilter.NOT_EQUAL,\n        SimpleFilter.STARTS_WITH, SimpleFilter.ENDS_WITH];\n\n    static DEFAULT_FORMATTER: TextFormatter = (from: string) => {\n        return from;\n    }\n\n    static DEFAULT_LOWERCASE_FORMATTER: TextFormatter = (from: string) => {\n        if (from == null) { return null; }\n        return from.toString().toLowerCase();\n    }\n\n    static DEFAULT_COMPARATOR: TextComparator = (filter: string, value: any, filterText: string) => {\n        switch (filter) {\n            case TextFilter.CONTAINS:\n                return value.indexOf(filterText) >= 0;\n            case TextFilter.NOT_CONTAINS:\n                return value.indexOf(filterText) === -1;\n            case TextFilter.EQUALS:\n                return value === filterText;\n            case TextFilter.NOT_EQUAL:\n                return value != filterText;\n            case TextFilter.STARTS_WITH:\n                return value.indexOf(filterText) === 0;\n            case TextFilter.ENDS_WITH:\n                const index = value.lastIndexOf(filterText);\n                return index >= 0 && index === (value.length - filterText.length);\n            default:\n                // should never happen\n                console.warn('invalid filter type ' + filter);\n                return false;\n        }\n    }\n\n    @RefSelector('eValue1')\n    private eValue1: HTMLInputElement;\n\n    @RefSelector('eValue2')\n    private eValue2: HTMLInputElement;\n\n    @RefSelector('eInputWrapper1')\n    private eInputWrapper1: HTMLElement;\n\n    @RefSelector('eInputWrapper2')\n    private eInputWrapper2: HTMLElement;\n\n    private comparator: TextComparator;\n    private formatter: TextFormatter;\n\n    private textFilterParams: ITextFilterParams;\n\n    protected getDefaultDebounceMs(): number {\n        return 500;\n    }\n\n    private getValue(element: HTMLInputElement): string {\n        let val = element.value;\n        val = _.makeNull(val);\n        if (val && val.trim() === '') {\n            val = null;\n        }\n        return val;\n    }\n\n    private addValueChangedListeners(): void {\n        const listener = () => this.onUiChanged();\n        this.addDestroyableEventListener(this.eValue1, 'input', listener);\n        this.addDestroyableEventListener(this.eValue2, 'input', listener);\n    }\n\n    protected setParams(params: ITextFilterParams): void {\n        super.setParams(params);\n\n        this.textFilterParams = params;\n        this.comparator = this.textFilterParams.textCustomComparator ? this.textFilterParams.textCustomComparator : TextFilter.DEFAULT_COMPARATOR;\n        this.formatter =\n            this.textFilterParams.textFormatter ? this.textFilterParams.textFormatter :\n                this.textFilterParams.caseSensitive == true ? TextFilter.DEFAULT_FORMATTER :\n                    TextFilter.DEFAULT_LOWERCASE_FORMATTER;\n\n        this.addValueChangedListeners();\n    }\n\n    protected setConditionIntoUi(model: TextFilterModel, position: ConditionPosition): void {\n        const positionOne = position === ConditionPosition.One;\n\n        const eValue = positionOne ? this.eValue1 : this.eValue2;\n\n        eValue.value = model ? model.filter : null;\n    }\n\n    protected createCondition(position: ConditionPosition): TextFilterModel {\n\n        const positionOne = position === ConditionPosition.One;\n\n        const type = positionOne ? this.getCondition1Type() : this.getCondition2Type();\n        const eValue = positionOne ? this.eValue1 : this.eValue2;\n        const value = this.getValue(eValue);\n\n        const model: TextFilterModel =  {\n            filterType: TextFilter.FILTER_TYPE,\n            type: type\n        };\n        if (!this.doesFilterHaveHiddenInput(type)) {\n            model.filter = value;\n        }\n        return model;\n    }\n\n    protected getFilterType(): string {\n        return TextFilter.FILTER_TYPE;\n    }\n\n    protected areSimpleModelsEqual(aSimple: TextFilterModel, bSimple: TextFilterModel): boolean {\n        return aSimple.filter === bSimple.filter && aSimple.type === bSimple.type;\n    }\n\n    protected resetUiToDefaults(): void {\n        super.resetUiToDefaults();\n\n        this.eValue1.value = null;\n        this.eValue2.value = null;\n    }\n\n    protected setValueFromFloatingFilter(value: string): void {\n        this.eValue1.value = value;\n        this.eValue2.value = null;\n    }\n\n    public getDefaultFilterOptions(): string[] {\n        return TextFilter.DEFAULT_FILTER_OPTIONS;\n    }\n\n    protected createValueTemplate(position: ConditionPosition): string {\n\n        const pos = position === ConditionPosition.One ? '1' : '2';\n        const translate = this.gridOptionsWrapper.getLocaleTextFunc();\n\n        return `<div class=\"ag-filter-body\" ref=\"eCondition${pos}Body\" role=\"presentation\">\n            <div class=\"ag-input-wrapper\" ref=\"eInputWrapper${pos}\" role=\"presentation\">\n                <input class=\"ag-filter-filter\" ref=\"eValue${pos}\" type=\"text\" placeholder=\"${translate('filterOoo', 'Filter...')}\"/>\n            </div>\n        </div>`;\n    }\n\n    protected updateUiVisibility(): void {\n        super.updateUiVisibility();\n\n        const showValue1 = this.showValueFrom(this.getCondition1Type());\n        _.setDisplayed(this.eInputWrapper1, showValue1);\n        const showValue2 = this.showValueFrom(this.getCondition2Type());\n        _.setDisplayed(this.eInputWrapper2, showValue2);\n    }\n\n    public afterGuiAttached() {\n        this.eValue1.focus();\n    }\n\n    protected isConditionUiComplete(position: ConditionPosition): boolean {\n        const positionOne = position === ConditionPosition.One;\n\n        const option = positionOne ? this.getCondition1Type() : this.getCondition2Type();\n        const eFilterValue = positionOne ? this.eValue1 : this.eValue2;\n\n        if (option === SimpleFilter.EMPTY) { return false; }\n\n        const value = this.getValue(eFilterValue);\n        if (this.doesFilterHaveHiddenInput(option)) {\n            return true;\n        }\n\n        return value != null;\n    }\n\n    public individualConditionPasses(params: IDoesFilterPassParams, filterModel: TextFilterModel): boolean {\n\n        const filterText:string =  filterModel.filter;\n        const filterOption:string = filterModel.type;\n        const cellValue = this.textFilterParams.valueGetter(params.node);\n        const cellValueFormatted = this.formatter(cellValue);\n\n        const customFilterOption = this.optionsFactory.getCustomOption(filterOption);\n        if (customFilterOption) {\n            // only execute the custom filter if a value exists or a value isn't required, i.e. input is hidden\n            if (filterText != null || customFilterOption.hideFilterInput) {\n                return customFilterOption.test(filterText, cellValueFormatted);\n            }\n        }\n\n        if (cellValue == null) {\n            return filterOption === SimpleFilter.NOT_EQUAL || filterOption === SimpleFilter.NOT_CONTAINS;\n        }\n\n        const filterTextFormatted: string = this.formatter(filterText);\n        return this.comparator(filterOption, cellValueFormatted, filterTextFormatted);\n    }\n\n}"]}