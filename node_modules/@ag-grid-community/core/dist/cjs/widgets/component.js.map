{"version":3,"sources":["../../src/ts/widgets/component.ts"],"names":[],"mappings":"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","file":"component.js","sourcesContent":["import { Context, PreConstruct } from \"../context/context\";\nimport { BeanStub } from \"../context/beanStub\";\nimport { IComponent } from \"../interfaces/iComponent\";\nimport { AgEvent } from \"../events\";\nimport { _, NumberSequence } from \"../utils\";\n\nconst compIdSequence = new NumberSequence();\n\nexport interface VisibleChangedEvent extends AgEvent {\n    visible: boolean;\n}\n\nexport class Component extends BeanStub {\n\n    public static EVENT_DISPLAYED_CHANGED = 'displayedChanged';\n\n    private eGui: HTMLElement;\n\n    private childComponents: IComponent<any>[] = [];\n\n    private annotatedEventListeners: any[] = [];\n\n    // if false, then CSS class \"ag-hidden\" is applied, which sets \"display: none\"\n    private displayed = true;\n\n    // if false, then CSS class \"ag-invisible\" is applied, which sets \"visibility: hidden\"\n    private visible = true;\n\n    protected parentComponent: Component | undefined;\n\n    // unique id for this row component. this is used for getting a reference to the HTML dom.\n    // we cannot use the RowNode id as this is not unique (due to animation, old rows can be lying\n    // around as we create a new rowComp instance for the same row node).\n    private compId = compIdSequence.next();\n\n    constructor(template?: string) {\n        super();\n        if (template) {\n            this.setTemplate(template);\n        }\n    }\n\n    public getCompId(): number {\n        return this.compId;\n    }\n\n    // for registered components only, eg creates AgCheckbox instance from ag-checkbox HTML tag\n    private createChildComponentsFromTags(parentNode: Element): void {\n\n        // we MUST take a copy of the list first, as the 'swapComponentForNode' adds comments into the DOM\n        // which messes up the traversal order of the children.\n        const childNodeList: Node[] = _.copyNodeList(parentNode.childNodes);\n\n        childNodeList.forEach((childNode: Node) => {\n            const childComp = this.getContext().createComponentFromElement(childNode as Element, (childComp) => {\n                // copy over all attributes, including css classes, so any attributes user put on the tag\n                // wll be carried across\n                this.copyAttributesFromNode(childNode as Element, childComp.getGui());\n            });\n            if (childComp) {\n                if ((childComp as any).addItems && (childNode as Element).children.length) {\n                    this.createChildComponentsFromTags(childNode as Element);\n\n                    // converting from HTMLCollection to Array\n                    const items = Array.prototype.slice.call((childNode as Element).children);\n\n                    (childComp as any).addItems(items);\n                }\n                // replace the tag (eg ag-checkbox) with the proper HTMLElement (eg 'div') in the dom\n                this.swapComponentForNode(childComp, parentNode, childNode);\n            } else if (childNode.childNodes) {\n                this.createChildComponentsFromTags(childNode as Element);\n            }\n        });\n    }\n\n    private copyAttributesFromNode(source: Element, dest: Element): void {\n        _.iterateNamedNodeMap(source.attributes,\n            (name: string, value: string) => {\n                dest.setAttribute(name, value);\n            }\n        );\n    }\n\n    private swapComponentForNode(newComponent: Component, parentNode: Element, childNode: Node): void {\n        const eComponent = newComponent.getGui();\n        parentNode.replaceChild(eComponent, childNode);\n        parentNode.insertBefore(document.createComment(childNode.nodeName), eComponent);\n        this.childComponents.push(newComponent);\n        this.swapInComponentForQuerySelectors(newComponent, childNode);\n    }\n\n    private swapInComponentForQuerySelectors(newComponent: Component, childNode: Node): void {\n\n        let thisProto: any = Object.getPrototypeOf(this);\n\n        const thisNoType = this as any;\n        while (thisProto != null) {\n            const metaData = thisProto.__agComponentMetaData;\n            const currentProtoName = (thisProto.constructor).name;\n\n            if (metaData && metaData[currentProtoName] && metaData[currentProtoName].querySelectors) {\n                metaData[currentProtoName].querySelectors.forEach((querySelector: any) => {\n                    if (thisNoType[querySelector.attributeName] === childNode) {\n                        thisNoType[querySelector.attributeName] = newComponent;\n                    }\n                });\n            }\n\n            thisProto = Object.getPrototypeOf(thisProto);\n        }\n    }\n\n    public setTemplate(template: string): void {\n        const eGui = _.loadTemplate(template as string);\n        this.setTemplateFromElement(eGui);\n    }\n\n    public setTemplateFromElement(element: HTMLElement): void {\n        this.eGui = element;\n        (this.eGui as any).__agComponent = this;\n        this.addAnnotatedEventListeners();\n        this.wireQuerySelectors();\n\n        // context will not be available when user sets template in constructor\n        const contextIsAvailable = !!this.getContext();\n        if (contextIsAvailable) {\n            this.createChildComponentsFromTags(this.getGui());\n        }\n    }\n\n    @PreConstruct\n    private createChildComponentsPreConstruct(): void {\n        // ui exists if user sets template in constructor. when this happens, we have to wait for the context\n        // to be autoWired first before we can create child components.\n        const uiExists = !!this.getGui();\n        if (uiExists) {\n            this.createChildComponentsFromTags(this.getGui());\n        }\n    }\n\n    protected wireQuerySelectors(): void {\n        if (!this.eGui) {\n            return;\n        }\n\n        let thisProto: any = Object.getPrototypeOf(this);\n\n        while (thisProto != null) {\n            const metaData = thisProto.__agComponentMetaData;\n            const currentProtoName = (thisProto.constructor).name;\n\n            if (metaData && metaData[currentProtoName] && metaData[currentProtoName].querySelectors) {\n                const thisNoType = this as any;\n                metaData[currentProtoName].querySelectors.forEach((querySelector: any) => {\n                    const resultOfQuery = this.eGui.querySelector(querySelector.querySelector);\n                    if (resultOfQuery) {\n                        const backingComponent = (resultOfQuery as any).__agComponent;\n                        if (backingComponent) {\n                            thisNoType[querySelector.attributeName] = backingComponent;\n                        } else {\n                            thisNoType[querySelector.attributeName] = resultOfQuery;\n                        }\n                    } else {\n                        // put debug msg in here if query selector fails???\n                    }\n                });\n            }\n\n            thisProto = Object.getPrototypeOf(thisProto);\n        }\n    }\n\n    private addAnnotatedEventListeners(): void {\n        this.removeAnnotatedEventListeners();\n        if (!this.eGui) {\n            return;\n        }\n\n        const listenerMethods = this.getAgComponentMetaData('listenerMethods');\n\n        if (_.missingOrEmpty(listenerMethods)) {\n            return;\n        }\n\n        if (!this.annotatedEventListeners) {\n            this.annotatedEventListeners = [];\n        }\n\n        listenerMethods.forEach((eventListener: any) => {\n            const listener = (this as any)[eventListener.methodName].bind(this);\n            this.eGui.addEventListener(eventListener.eventName, listener);\n            this.annotatedEventListeners.push({eventName: eventListener.eventName, listener: listener});\n        });\n    }\n\n    private getAgComponentMetaData(key: string): any[] {\n        let res: any[] = [];\n\n        let thisProto: any = Object.getPrototypeOf(this);\n\n        while (thisProto != null) {\n            const metaData = thisProto.__agComponentMetaData;\n            let currentProtoName = (thisProto.constructor).name;\n\n            // IE does not support Function.prototype.name, so we need to extract\n            // the name using a RegEx\n            // from: https://matt.scharley.me/2012/03/monkey-patch-name-ie.html\n            if (currentProtoName === undefined) {\n                const funcNameRegex = /function\\s([^(]{1,})\\(/;\n                const results = funcNameRegex.exec(thisProto.constructor.toString());\n                if (results && results.length > 1) {\n                    currentProtoName = results[1].trim();\n                }\n            }\n\n            if (metaData && metaData[currentProtoName] && metaData[currentProtoName][key]) {\n                res = res.concat(metaData[currentProtoName][key]);\n            }\n\n            thisProto = Object.getPrototypeOf(thisProto);\n        }\n\n        return res;\n    }\n\n    private removeAnnotatedEventListeners(): void {\n        if (!this.annotatedEventListeners || !this.eGui) {\n            return;\n        }\n\n        this.annotatedEventListeners.forEach((eventListener: any) => {\n            this.eGui.removeEventListener(eventListener.eventName, eventListener.listener);\n        });\n        this.annotatedEventListeners = [];\n    }\n\n    public getGui(): HTMLElement {\n        return this.eGui;\n    }\n\n    public setParentComponent(component: Component) {\n        this.parentComponent = component;\n    }\n\n    public getParentComponent(): Component | undefined {\n        return this.parentComponent;\n    }\n\n    // this method is for older code, that wants to provide the gui element,\n    // it is not intended for this to be in ag-Stack\n    protected setGui(eGui: HTMLElement): void {\n        this.eGui = eGui;\n    }\n\n    protected queryForHtmlElement(cssSelector: string): HTMLElement {\n        return this.eGui.querySelector(cssSelector) as HTMLElement;\n    }\n\n    protected queryForHtmlInputElement(cssSelector: string): HTMLInputElement {\n        return this.eGui.querySelector(cssSelector) as HTMLInputElement;\n    }\n\n    public appendChild(newChild: Node | IComponent<any>): void {\n        if (_.isNodeOrElement(newChild)) {\n            this.eGui.appendChild(newChild as Node);\n        } else {\n            const childComponent = newChild as IComponent<any>;\n            this.eGui.appendChild(childComponent.getGui());\n            this.childComponents.push(childComponent);\n        }\n    }\n\n    public addFeature(feature: BeanStub, context?: Context): void {\n        this.wireDependentBean(feature, context);\n    }\n\n    public isDisplayed(): boolean {\n        return this.displayed;\n    }\n\n    public setVisible(visible: boolean): void {\n        if (visible !== this.visible) {\n            this.visible = visible;\n\n            _.setVisible(this.eGui, visible);\n        }\n    }\n\n    public setDisplayed(displayed: boolean): void {\n        if (displayed !== this.displayed) {\n            this.displayed = displayed;\n\n            _.setDisplayed(this.eGui, displayed);\n            const event: VisibleChangedEvent = {\n                type: Component.EVENT_DISPLAYED_CHANGED,\n                visible: this.displayed\n            };\n            this.dispatchEvent(event);\n        }\n    }\n\n    public addOrRemoveCssClass(className: string, addOrRemove: boolean): void {\n        _.addOrRemoveCssClass(this.eGui, className, addOrRemove);\n    }\n\n    public destroy(): void {\n        super.destroy();\n        this.childComponents.forEach(childComponent => {\n            if (childComponent && childComponent.destroy) {\n                (childComponent as any).destroy();\n            }\n        });\n        this.childComponents.length = 0;\n\n        this.removeAnnotatedEventListeners();\n    }\n\n    public addGuiEventListener(event: string, listener: (event: any) => void): void {\n        this.getGui().addEventListener(event, listener);\n        this.addDestroyFunc(() => this.getGui().removeEventListener(event, listener));\n    }\n\n    public addCssClass(className: string): void {\n        _.addCssClass(this.getGui(), className);\n    }\n\n    public removeCssClass(className: string): void {\n        _.removeCssClass(this.getGui(), className);\n    }\n\n    public getAttribute(key: string): string | null {\n        const eGui = this.getGui();\n        return eGui ? eGui.getAttribute(key) : null;\n    }\n\n    public getRefElement(refName: string): HTMLElement {\n        return this.queryForHtmlElement('[ref=\"' + refName + '\"]');\n    }\n}"]}