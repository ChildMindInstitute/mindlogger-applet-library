{"version":3,"sources":["../../src/ts/context/beanStub.ts"],"names":[],"mappings":"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","file":"beanStub.js","sourcesContent":["import { IEventEmitter } from \"../interfaces/iEventEmitter\";\nimport { EventService } from \"../eventService\";\nimport { GridOptionsWrapper } from \"../gridOptionsWrapper\";\nimport { AgEvent } from \"../events\";\nimport { Autowired, Context, PreDestroy } from \"./context\";\nimport { _ } from \"../utils\";\nimport { IFrameworkOverrides } from \"../interfaces/iFrameworkOverrides\";\n\nexport class BeanStub implements IEventEmitter {\n\n    public static EVENT_DESTROYED = 'destroyed';\n\n    protected localEventService: EventService;\n\n    private destroyFunctions: (() => void)[] = [];\n    private destroyed = false;\n\n    @Autowired('context') private context: Context;\n    @Autowired('frameworkOverrides') private frameworkOverrides: IFrameworkOverrides;\n\n    // this was a test constructor niall built, when active, it prints after 5 seconds all beans/components that are\n    // not destroyed. to use, create a new grid, then api.destroy() before 5 seconds. then anything that gets printed\n    // points to a bean or component that was not properly disposed of.\n    // constructor() {\n    //     setTimeout(()=> {\n    //         if (this.isAlive()) {\n    //             let prototype: any = Object.getPrototypeOf(this);\n    //             const constructor: any = prototype.constructor;\n    //             const constructorString = constructor.toString();\n    //             const beanName = constructorString.substring(9, constructorString.indexOf(\"(\"));\n    //             console.log('is alive ' + beanName);\n    //         }\n    //     }, 5000);\n    // }\n\n    // CellComp and GridComp and override this because they get the FrameworkOverrides from the Beans bean\n    protected getFrameworkOverrides(): IFrameworkOverrides {\n        return this.frameworkOverrides;\n    }\n\n    public getContext = (): Context => this.context;\n\n    @PreDestroy\n    public destroy(): void {\n\n        // let prototype: any = Object.getPrototypeOf(this);\n        // const constructor: any = prototype.constructor;\n        // const constructorString = constructor.toString();\n        // const beanName = constructorString.substring(9, constructorString.indexOf(\"(\"));\n\n        this.destroyFunctions.forEach(func => func());\n        this.destroyFunctions.length = 0;\n        this.destroyed = true;\n\n        this.dispatchEvent({ type: BeanStub.EVENT_DESTROYED });\n    }\n\n    public addEventListener(eventType: string, listener: Function): void {\n        if (!this.localEventService) {\n            this.localEventService = new EventService();\n        }\n\n        this.localEventService.addEventListener(eventType, listener);\n    }\n\n    public removeEventListener(eventType: string, listener: Function): void {\n        if (this.localEventService) {\n            this.localEventService.removeEventListener(eventType, listener);\n        }\n    }\n\n    public dispatchEventAsync(event: AgEvent): void {\n        window.setTimeout(() => this.dispatchEvent(event), 0);\n    }\n\n    public dispatchEvent<T extends AgEvent>(event: T): void {\n        if (this.localEventService) {\n            this.localEventService.dispatchEvent(event);\n        }\n    }\n\n    public addDestroyableEventListener(\n        object: Window | HTMLElement | IEventEmitter | GridOptionsWrapper,\n        event: string,\n        listener: (event?: any) => void\n    ): (() => void) | undefined {\n        if (this.destroyed) {\n            return;\n        }\n\n        if (object instanceof HTMLElement) {\n            _.addSafePassiveEventListener(this.getFrameworkOverrides(), object as HTMLElement, event, listener);\n        } else {\n            (object as any).addEventListener(event, listener);\n        }\n\n        const destroyFunc = () => {\n            (object as any).removeEventListener(event, listener);\n\n            this.destroyFunctions = this.destroyFunctions.filter(fn => fn !== destroyFunc);\n        };\n\n        this.destroyFunctions.push(destroyFunc);\n\n        return destroyFunc;\n    }\n\n    public isAlive = (): boolean => !this.destroyed;\n\n    public addDestroyFunc(func: () => void): void {\n        // if we are already destroyed, we execute the func now\n        if (this.isAlive()) {\n            this.destroyFunctions.push(func);\n        } else {\n            func();\n        }\n    }\n\n    public wireDependentBean<T extends BeanStub>(bean: T, context?: Context): T {\n        if (bean.destroy) {\n            this.addDestroyFunc(bean.destroy.bind(bean));\n        }\n\n        return this.wireBean(bean, context);\n    }\n\n    protected wireBean<T extends BeanStub>(bean: T, context?: Context): T {\n        (context || this.getContext()).wireBean(bean);\n        return bean;\n    }\n}\n"]}