{"remainingRequest":"/Volumes/Disk1/work/work/mindlogger/mindlogger-applet-library/node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js!/Volumes/Disk1/work/work/mindlogger/mindlogger-applet-library/node_modules/vuetify-loader/lib/loader.js??ref--18-0!/Volumes/Disk1/work/work/mindlogger/mindlogger-applet-library/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Volumes/Disk1/work/work/mindlogger/mindlogger-applet-library/node_modules/vue-loader/lib/index.js??vue-loader-options!/Volumes/Disk1/work/work/mindlogger/mindlogger-applet-library/src/pages/LibrarySearch.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Volumes/Disk1/work/work/mindlogger/mindlogger-applet-library/src/pages/LibrarySearch.vue","mtime":1617594617000},{"path":"/Volumes/Disk1/work/work/mindlogger/mindlogger-applet-library/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/Disk1/work/work/mindlogger/mindlogger-applet-library/node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Volumes/Disk1/work/work/mindlogger/mindlogger-applet-library/node_modules/vuetify-loader/lib/loader.js","mtime":1574476662000},{"path":"/Volumes/Disk1/work/work/mindlogger/mindlogger-applet-library/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/Disk1/work/work/mindlogger/mindlogger-applet-library/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/es6.object.keys\";\nimport _defineProperty from \"/Volumes/Disk1/work/work/mindlogger/mindlogger-applet-library/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport \"core-js/modules/es6.array.find-index\";\nimport \"core-js/modules/es6.array.find\";\nimport \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport \"core-js/modules/es6.string.starts-with\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.string.iterator\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Volumes/Disk1/work/work/mindlogger/mindlogger-applet-library/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport api from \"../services/Api/api.vue\";\nexport default {\n  name: 'LibrarySearch',\n  components: {},\n  data: function data() {\n    return {\n      searchText: \"\",\n      isLoading: true,\n      items: [{\n        id: 1,\n        name: 'Root',\n        children: [{\n          id: 2,\n          name: 'Child #1'\n        }, {\n          id: 3,\n          name: 'Child #2'\n        }, {\n          id: 4,\n          name: 'Child #3',\n          children: [{\n            id: 5,\n            name: 'Grandchild #1'\n          }, {\n            id: 6,\n            name: 'Grandchild #2'\n          }]\n        }]\n      }],\n      selectedApplets: {},\n      appletsTree: [],\n      baskets: [],\n      selection: []\n    };\n  },\n  beforeMount: function () {\n    var _beforeMount = _asyncToGenerator(\n    /*#__PURE__*/\n    regeneratorRuntime.mark(function _callee2() {\n      var _this = this;\n\n      var publishedApplets;\n      return regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              this.isLoading = true;\n              _context2.next = 4;\n              return api.getPublishedApplets({\n                apiHost: this.$store.state.backend\n              });\n\n            case 4:\n              publishedApplets = _context2.sent.data;\n              _context2.next = 7;\n              return Promise.all(publishedApplets.map(\n              /*#__PURE__*/\n              function () {\n                var _ref = _asyncToGenerator(\n                /*#__PURE__*/\n                regeneratorRuntime.mark(function _callee(applet) {\n                  var response;\n                  return regeneratorRuntime.wrap(function _callee$(_context) {\n                    while (1) {\n                      switch (_context.prev = _context.next) {\n                        case 0:\n                          _context.prev = 0;\n                          _context.next = 3;\n                          return api.getAppletContent({\n                            apiHost: _this.$store.state.backend,\n                            libraryId: applet.id\n                          });\n\n                        case 3:\n                          response = _context.sent;\n                          return _context.abrupt(\"return\", _this.buildAppletTree(response.data));\n\n                        case 7:\n                          _context.prev = 7;\n                          _context.t0 = _context[\"catch\"](0);\n                          console.log(_context.t0);\n\n                        case 10:\n                        case \"end\":\n                          return _context.stop();\n                      }\n                    }\n                  }, _callee, null, [[0, 7]]);\n                }));\n\n                return function (_x) {\n                  return _ref.apply(this, arguments);\n                };\n              }()));\n\n            case 7:\n              this.appletsTree = _context2.sent;\n              this.$store.commit(\"setPublishedApplets\", publishedApplets);\n              this.publishedApplets();\n              this.isLoading = false;\n              _context2.next = 16;\n              break;\n\n            case 13:\n              _context2.prev = 13;\n              _context2.t0 = _context2[\"catch\"](0);\n              console.log(_context2.t0);\n\n            case 16:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, this, [[0, 13]]);\n    }));\n\n    function beforeMount() {\n      return _beforeMount.apply(this, arguments);\n    }\n\n    return beforeMount;\n  }(),\n  methods: {\n    publishedApplets: function publishedApplets() {\n      var _this2 = this;\n\n      if (this.searchText) {\n        return this.$store.state.publishedApplets.forEach(function (applet) {\n          applet.keywords.forEach(function (keyword) {\n            if (keyword.startsWith(_this2.searchText)) {\n              return true;\n            }\n          });\n          return false;\n        });\n      } else {\n        return this.$store.state.publishedApplets;\n      }\n    },\n    onAddBasket: function onAddBasket(appletId) {\n      var _this3 = this;\n\n      var form = new FormData();\n      form.set(\"basket\", JSON.stringify(this.selectedApplets[appletId]));\n      api.addAppletsToBasket({\n        apiHost: this.$store.state.backend,\n        data: form\n      }).then(function () {\n        if (!_this3.baskets.includes(appletId)) {\n          _this3.baskets.push(appletId);\n        }\n      });\n    },\n    buildAppletTree: function buildAppletTree(appletData) {\n      var items = appletData.items,\n          activities = appletData.activities,\n          applet = appletData.applet;\n      var treeItem = {\n        id: 1,\n        appletId: applet._id.substring(7),\n        name: appletData.applet[\"@id\"],\n        children: []\n      };\n      var index = 2;\n\n      for (var activityId in activities) {\n        var activityItem = {\n          id: index,\n          activityId: activityId,\n          name: activities[activityId][\"@id\"],\n          children: []\n        };\n        index += 1;\n\n        for (var itemId in items) {\n          var values = itemId.split('/');\n\n          if (activityId === values[0]) {\n            var item = {\n              id: index,\n              itemId: values[1],\n              inputType: items[itemId][\"reprolib:terms/inputType\"][0][\"@value\"],\n              name: items[itemId][\"@id\"]\n            };\n            index += 1;\n            activityItem.children.push(item);\n          }\n        }\n\n        treeItem.children.push(activityItem);\n      }\n\n      return treeItem;\n    },\n\n    /*\n     * Change appletTreeData format to basket data \n     */\n    onAppletSelection: function onAppletSelection() {\n      var _this4 = this;\n\n      var selectedApplets = {};\n      this.selection.forEach(function (_ref2) {\n        var id = _ref2.id;\n\n        _this4.appletsTree.forEach(function (applet) {\n          applet.children.forEach(function (activity) {\n            var selectedItem = activity.children.find(function (item) {\n              return item.id === id;\n            });\n\n            if (selectedItem) {\n              if (!selectedApplets[applet.appletId]) {\n                selectedApplets[applet.appletId] = [];\n              }\n\n              var actIndex = selectedApplets[applet.appletId].findIndex(function (_ref3) {\n                var activityId = _ref3.activityId;\n                return activity.activityId;\n              });\n\n              if (actIndex === -1) {\n                var act = {\n                  activityId: activity.activityId\n                };\n\n                if (activity.children.length === 1) {\n                  act.items = null;\n                } else {\n                  act.items = [];\n                  act.items.push(selectedItem.itemId);\n                }\n\n                selectedApplets[applet.appletId].push(act);\n              } else if (selectedApplets[applet.appletId][actIndex].items) {\n                selectedApplets[applet.appletId][actIndex].items.push(selectedItem.itemId);\n\n                if (selectedApplets[applet.appletId][actIndex].items.length === activity.children.length) {\n                  selectedApplets[applet.appletId][actIndex].items = null;\n                }\n              }\n            }\n          });\n        });\n      });\n      this.selectedApplets = _objectSpread({}, selectedApplets);\n    },\n    onSearchText: function onSearchText() {}\n  }\n};",{"version":3,"sources":["LibrarySearch.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div v-show=\"!isLoading\">\n    <div class=\"d-flex align-center justify-center align-content-ceneter\">\n      <v-text-field\n        v-model=\"searchText\"\n        @input=\"onSearchText\"\n        light\n        solo\n        prepend-inner-icon=\"search\"\n        placeholder=\"Type keyword...\">\n      </v-text-field>\n\n      <v-badge\n        v-if=\"baskets.length\"\n        color=\"primary\"\n        :content=\"baskets.length\"\n        bottom\n        offset-x=\"35\"\n        offset-y=\"37\"\n      >\n        <v-icon color=\"blue-grey darken-3\" large class=\"mx-4 mb-6\">\n          mdi-basket-outline \n        </v-icon>\n      </v-badge>\n      <v-badge\n        v-else\n        color=\"primary\"\n        content=\"0\"\n        bottom\n        offset-x=\"35\"\n        offset-y=\"37\"\n      >\n        <v-icon color=\"blue-grey darken-3\" large class=\"mx-4 mb-6\">\n          mdi-basket-outline \n        </v-icon>\n      </v-badge>\n    </div>\n\n    <div class=\"mt-0\">\n      <v-card \n        class=\"mx-auto mb-4 d-flex pa-md-2\"\n        v-for=\"applet in publishedApplets()\"\n      >\n        <div class=\"text-center\">\n          <v-img\n            v-if=\"applet.image\"\n            class=\"ma-2 ds-avatar\"\n            src=\"https://cdn.vuetifyjs.com/images/cards/sunshine.jpg\"\n            max-width=\"150px\"\n            height=\"150px\"\n          />\n\n          <v-avatar\n            v-else\n            tile\n            class=\"ma-2 ds-avatar\"\n            color=\"blue\"\n            size=\"150\"\n          >\n            <span class=\"white--text text-h3\">\n              {{ applet.name[0] }}\n            </span>\n          </v-avatar>\n        </div>\n        <div class=\"ds-tree-layout ml-2\">\n          <v-card-title class=\"text-decoration-underline text-h6\">\n            {{ applet.name }}\n          </v-card-title>\n\n          <v-card-subtitle \n            v-if=\"applet.description\"\n            class=\"mx-6 black--text text-body-1 ds-subtitle\"\n          >\n            Description: {{ applet.description }}\n          </v-card-subtitle>\n\n          <v-card-actions class=\"mx-5 px-2 py-0\">\n            <span \n              v-if=\"applet.keywords.length\"\n              class=\"text-body-1\"\n            >\n              Keywords: \n            </span>\n            <v-btn\n              v-for=\"keyword in applet.keywords\"\n              color=\"orange lighten-2\"\n              text\n            >\n              {{ keyword }}\n            </v-btn>\n          </v-card-actions>\n\n          <v-expand-transition>\n            <v-treeview\n              class=\"d-flex justify-start ds-tree-view\"\n              v-model=\"selection\"\n              :items=\"appletsTree\"\n              selection-type=\"leaf\"\n              color=\"primary\"\n              selected-color=\"primary\"\n              on-icon=\"mdi-bookmark\"\n              off-icon=\"mdi-bookmark-outline\"\n              indeterminate-icon=\"mdi-bookmark-minus\"\n              @input=\"onAppletSelection\"\n              open-on-click\n              activatable\n              selectable\n              hoverable\n              return-object\n            >\n            </v-treeview>\n          </v-expand-transition>\n        </div>\n        <div class=\"d-flex align-baseline\">\n          <v-btn\n            class=\"mx-2 mt-2\"\n            fab\n            small\n            @click=\"onAddBasket(applet.appletId)\"\n            :disabled=\"!selectedApplets[applet.appletId]\"\n          >\n            <v-icon color=\"grey darken-3\" >\n              mdi-basket-plus-outline\n            </v-icon>\n          </v-btn>\n\n          <v-btn\n            class=\"ml-2 mt-2 mr-6\"\n            fab\n            small\n          >\n            <v-icon color=\"grey darken-3\">\n              mdi-information-outline\n            </v-icon>\n          </v-btn>\n        </div>\n      </v-card>\n    </div>\n  </div>\n</template>\n\n<style lang=\"scss\">\n.ds-avatar {\n  border-radius: 4px !important;\n}\n\n.ds-subtitle {\n  padding: 4px !important;\n  margin-top: 0 !important;\n}\n\n.v-treeview-node__content {\n  flex-direction: column;\n}\n\n.ds-tree-view, .ds-tree-layout {\n  width: 100%\n}\n\n.v-treeview-node {\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n}\n</style>\n\n<script>\nimport api from \"../services/Api/api.vue\";\n\nexport default {\n  name: 'LibrarySearch',\n  components: {\n\n  },\n  data() {\n    return {\n      searchText: \"\",\n      isLoading: true,\n      items: [\n        {\n          id: 1,\n          name: 'Root',\n          children: [\n            { id: 2, name: 'Child #1' },\n            { id: 3, name: 'Child #2' },\n            {\n              id: 4,\n              name: 'Child #3',\n              children: [\n                { id: 5, name: 'Grandchild #1' },\n                { id: 6, name: 'Grandchild #2' },\n              ],\n            },\n          ],\n        },\n      ],\n      selectedApplets: {},\n      appletsTree: [],\n      baskets: [],\n      selection: [],\n      \n    };\n  },\n  async beforeMount() {\n    try {\n      this.isLoading = true;\n      const publishedApplets = (await api.getPublishedApplets({\n        apiHost: this.$store.state.backend,\n      })).data;\n\n      this.appletsTree = await Promise.all(publishedApplets.map(async (applet) => {\n        try {\n          const response = await api.getAppletContent({\n            apiHost: this.$store.state.backend,\n            libraryId: applet.id,\n          });\n\n          return this.buildAppletTree(response.data);\n        } catch (error) {\n          console.log(error)\n        }\n      }));\n\n      this.$store.commit(\"setPublishedApplets\", publishedApplets);\n      this.publishedApplets();\n      this.isLoading = false;\n    } catch(err) {\n      console.log(err);\n    }\n  },\n  methods: {\n    publishedApplets() {\n      if (this.searchText) {\n        return this.$store.state.publishedApplets.forEach(applet => {\n          applet.keywords.forEach(keyword => {\n            if (keyword.startsWith(this.searchText)) {\n              return true;\n            }\n          });\n\n          return false;\n        });\n      } else {\n        return this.$store.state.publishedApplets;\n      }\n    },\n    onAddBasket (appletId) {\n      const form = new FormData();\n\n      form.set(\"basket\", JSON.stringify(this.selectedApplets[appletId]));\n      api.addAppletsToBasket({\n        apiHost: this.$store.state.backend,\n        data: form,\n      }).then(() => {\n        if (!this.baskets.includes(appletId)) {\n          this.baskets.push(appletId);\n        }\n      });\n    },\n    buildAppletTree (appletData) {\n      const { items, activities, applet } = appletData;\n      const treeItem = {\n        id: 1,\n        appletId: applet._id.substring(7),\n        name: appletData.applet[\"@id\"],\n        children: [],\n      };\n\n      let index = 2;\n\n      for (const activityId in activities) {\n        const activityItem = {\n          id: index,\n          activityId,\n          name: activities[activityId][\"@id\"],\n          children: [],\n        };\n\n        index += 1;\n        for (const itemId in items) {\n          const values = itemId.split('/');\n\n          if (activityId === values[0]) {\n            const item = {\n              id: index,\n              itemId: values[1],\n              inputType: items[itemId][\"reprolib:terms/inputType\"][0][\"@value\"],\n              name: items[itemId][\"@id\"]\n            };\n\n            index += 1;\n            activityItem.children.push(item);\n          }\n        }\n\n        treeItem.children.push(activityItem);\n      }\n\n      return treeItem;\n    },\n    /*\n     * Change appletTreeData format to basket data \n     */\n    onAppletSelection() {\n      const selectedApplets = {};\n\n      this.selection.forEach(({ id }) => {\n        this.appletsTree.forEach(applet => {\n          applet.children.forEach(activity => {\n            const selectedItem = activity.children.find(item => item.id === id);\n\n            if (selectedItem) {\n              if (!selectedApplets[applet.appletId]) {\n                selectedApplets[applet.appletId] = [];\n              }\n\n              const actIndex = selectedApplets[applet.appletId].findIndex(({ activityId }) => activity.activityId);\n\n              if (actIndex === -1) {\n                const act = {\n                  activityId: activity.activityId,\n                };\n\n                if (activity.children.length === 1) {\n                  act.items = null;\n                } else {\n                  act.items = [];\n                  act.items.push(selectedItem.itemId);\n                }\n                selectedApplets[applet.appletId].push(act);\n              } else if (selectedApplets[applet.appletId][actIndex].items) {\n                selectedApplets[applet.appletId][actIndex].items.push(selectedItem.itemId);\n\n                if (selectedApplets[applet.appletId][actIndex].items.length === activity.children.length) {\n                  selectedApplets[applet.appletId][actIndex].items = null;\n                }\n              }\n            }\n          });\n        });\n      });\n\n      this.selectedApplets = { ...selectedApplets };\n    },\n    onSearchText () {\n\n    }\n  },\n};\n</script>\n"],"sourceRoot":"src/pages"}]}